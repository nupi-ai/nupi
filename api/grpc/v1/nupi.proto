syntax = "proto3";

package nupi.api.v1;

option go_package = "github.com/nupi-ai/nupi/internal/api/grpc/v1;v1";

import "adapters.proto";
import "audio.proto";
import "auth.proto";
import "config.proto";
import "daemon.proto";
import "google/protobuf/empty.proto";
import "recordings.proto";
import "sessions.proto";

// ─── Services ───
//
// NOTE: The Prometheus /metrics endpoint (GET /metrics) is intentionally NOT
// represented as a gRPC RPC. Prometheus scrapes HTTP endpoints by design and
// this is a standard industry exception to AD-7 transport unification.

service DaemonService {
  rpc Status(DaemonStatusRequest) returns (DaemonStatusResponse);
  rpc Shutdown(ShutdownRequest) returns (ShutdownResponse);
  rpc GetPluginWarnings(GetPluginWarningsRequest) returns (GetPluginWarningsResponse);
  rpc ListLanguages(ListLanguagesRequest) returns (ListLanguagesResponse);
  rpc ReloadPlugins(ReloadPluginsRequest) returns (ReloadPluginsResponse);
}

service SessionsService {
  rpc ListSessions(ListSessionsRequest) returns (ListSessionsResponse);
  rpc CreateSession(CreateSessionRequest) returns (CreateSessionResponse);
  rpc GetSession(GetSessionRequest) returns (GetSessionResponse);
  rpc KillSession(KillSessionRequest) returns (KillSessionResponse);
  rpc SendInput(SendInputRequest) returns (SendInputResponse);
  rpc AttachSession(stream AttachSessionRequest) returns (stream AttachSessionResponse);
  rpc GetSessionMode(GetSessionModeRequest) returns (GetSessionModeResponse);
  rpc SetSessionMode(SetSessionModeRequest) returns (SetSessionModeResponse);
  rpc GetConversation(GetConversationRequest) returns (GetConversationResponse);
  rpc GetGlobalConversation(GetGlobalConversationRequest) returns (GetGlobalConversationResponse);
  rpc SendVoiceCommand(SendVoiceCommandRequest) returns (SendVoiceCommandResponse);
}

service AdapterRuntimeService {
  rpc Overview(google.protobuf.Empty) returns (AdaptersOverviewResponse);
  rpc BindAdapter(BindAdapterRequest) returns (AdapterActionResponse);
  rpc StartAdapter(AdapterSlotRequest) returns (AdapterActionResponse);
  rpc StopAdapter(AdapterSlotRequest) returns (AdapterActionResponse);
  rpc RegisterAdapter(RegisterAdapterRequest) returns (RegisterAdapterResponse);
  rpc StreamAdapterLogs(StreamAdapterLogsRequest) returns (stream AdapterLogStreamEntry);
  rpc GetAdapterLogs(GetAdapterLogsRequest) returns (GetAdapterLogsResponse);
}

service AudioService {
  rpc StreamAudioIn(stream StreamAudioInRequest) returns (StreamAudioInResponse);
  rpc StreamAudioOut(StreamAudioOutRequest) returns (stream StreamAudioOutResponse);
  rpc InterruptTTS(InterruptTTSRequest) returns (google.protobuf.Empty);
  rpc GetAudioCapabilities(GetAudioCapabilitiesRequest) returns (GetAudioCapabilitiesResponse);
}

service AuthService {
  rpc ListTokens(ListTokensRequest) returns (ListTokensResponse);
  rpc CreateToken(CreateTokenRequest) returns (CreateTokenResponse);
  rpc DeleteToken(DeleteTokenRequest) returns (google.protobuf.Empty);
  rpc ListPairings(ListPairingsRequest) returns (ListPairingsResponse);
  rpc CreatePairing(CreatePairingRequest) returns (CreatePairingResponse);
  rpc ClaimPairing(ClaimPairingRequest) returns (ClaimPairingResponse);
  rpc RegisterPushToken(RegisterPushTokenRequest) returns (RegisterPushTokenResponse);
  rpc UnregisterPushToken(UnregisterPushTokenRequest) returns (UnregisterPushTokenResponse);
}

service RecordingsService {
  rpc ListRecordings(ListRecordingsRequest) returns (ListRecordingsResponse);
  rpc GetRecording(GetRecordingRequest) returns (stream RecordingChunk);
}

service ConfigService {
  rpc GetTransportConfig(google.protobuf.Empty) returns (TransportConfig);
  rpc UpdateTransportConfig(UpdateTransportConfigRequest) returns (TransportConfig);
  rpc Migrate(ConfigMigrateRequest) returns (ConfigMigrateResponse);
}

service AdaptersService {
  rpc ListAdapters(google.protobuf.Empty) returns (ListAdaptersResponse);
  rpc ListAdapterBindings(google.protobuf.Empty) returns (ListAdapterBindingsResponse);
  rpc SetAdapterBinding(SetAdapterBindingRequest) returns (AdapterBinding);
  rpc ClearAdapterBinding(ClearAdapterBindingRequest) returns (google.protobuf.Empty);
}

service QuickstartService {
  rpc GetStatus(google.protobuf.Empty) returns (QuickstartStatusResponse);
  rpc Update(UpdateQuickstartRequest) returns (QuickstartStatusResponse);
}
